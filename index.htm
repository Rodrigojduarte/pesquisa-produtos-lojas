<script>
  const input = document.getElementById('busca');
  const resultados = document.getElementById('resultados');

  input.addEventListener('input', async () => {
    const query = input.value.trim();
    if (query.length < 3) {
      resultados.innerHTML = '';
      return;
    }

    resultados.innerHTML = '⏳ Buscando...';

    try {
      const res = await fetch(`https://n8n.rjduarte.com.br/webhook/d67fd1c9-e927-4df8-88eb-c90e604c2077?busca=${encodeURIComponent(query)}`);
      const data = await res.json();

      if (data.length === 0) {
        resultados.innerHTML = '<p class="sem-resultado">Nenhum produto encontrado.</p>';
        return;
      }

      resultados.innerHTML = data.map(prod => `
        <div class="resultado">
          <strong>${prod.nome}</strong><br>
          <small>SKU: ${prod.sku} | Marca: ${prod.marca} | Cód. Barras: ${prod.codigobarra}</small><br>
          <strong>Preço Loja: R$ ${Number(prod.preco_nct).toFixed(2)}</strong>
          <div class="estoque">
            AQA: ${prod.estoque.nctaqa} | OUT: ${prod.estoque.nctout} | CD ACO: ${prod.estoque.cdaco} | WeWork: ${prod.estoque.wework} | Showroom: ${prod.estoque.showroom}
          </div>
        </div>
      `).join('');

    } catch (error) {
      resultados.innerHTML = '<p class="sem-resultado">Erro ao buscar produtos. Tente novamente.</p>';
    }
  });
</script>
